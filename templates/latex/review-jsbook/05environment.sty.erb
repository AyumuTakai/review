\newenvironment{shadedb}{%
  \def\FrameCommand{\fboxsep=\FrameSep \colorbox{shadecolorb}}%
  \MakeFramed {\FrameRestore}}%
 {\endMakeFramed}

\newcommand{\parasep}{\vspace*{3zh}}
\setlength{\footskip}{30pt}

\renewcommand{\lstlistingname}{<%= escape_latex(I18n.t('list')) %>}
\lstset{%
  breaklines=true,%
  breakautoindent=false,%
  breakindent=0pt,%
  fontadjust=true,%
  backgroundcolor=\color{shadecolor},%
  frame=single,%
  framerule=0pt,%
  basicstyle=\ttfamily\scriptsize,%
  commentstyle=\color{reviewgreen},%
  identifierstyle=\color{reviewblue},%
  stringstyle=\color{reviewred},%
  keywordstyle=\bfseries\color{reviewdarkred},%
}

\lstnewenvironment{reviewemlistlst}[1][]{\lstset{#1}}{}
\lstnewenvironment{reviewemlistnumlst}[1][]{\lstset{numbers=left, #1}}{}
\lstnewenvironment{reviewlistlst}[1][]{\lstset{#1}}{}
\lstnewenvironment{reviewlistnumlst}[1][]{\lstset{numbers=left, #1}}{}
\lstnewenvironment{reviewsourcelst}[1][]{\lstset{#1}}{}
\lstnewenvironment{reviewsourcenumlst}[1][]{\lstset{numbers=left, #1}}{}
\lstnewenvironment{reviewcmdlst}[1][]{\lstset{backgroundcolor=\color{white}, frameround=tttt, frame=trbl, #1}}{}

\newenvironment{reviewimage}{%
  \begin{figure}[H]
    \begin{center}}{%
    \end{center}
  \end{figure}}

\newenvironment{reviewdummyimage}{%
  \begin{figure}[H]
    \begin{center}\begin{alltt}}{%
    \end{alltt}\end{center}
  \end{figure}}

\newenvironment{reviewemlist}{%
  \medskip\small\begin{shaded}\setlength{\baselineskip}{1.3zw}\begin{alltt}}{%
  \end{alltt}\end{shaded}}

\newenvironment{reviewlist}{%
  \begin{shaded}\small\setlength{\baselineskip}{1.3zw}\begin{alltt}}{%
  \end{alltt}\end{shaded}\par\vspace*{0.5zw}}

\newenvironment{reviewsource}{%
  \begin{shaded}\small\setlength{\baselineskip}{1.3zw}\begin{alltt}}{%
  \end{alltt}\end{shaded}\par\vspace*{0.5zw}}

\newenvironment{reviewcmd}{%
  \color{white}\medskip\small\begin{shadedb}\setlength{\baselineskip}{1.3zw}\begin{alltt}}{%
  \end{alltt}\end{shadedb}}

\newenvironment{reviewbox}{%
  \medskip\small\begin{framed}\setlength{\baselineskip}{1.3zw}\begin{alltt}}{%
  \end{alltt}\end{framed}}

\newenvironment{reviewtable}[1]{%
  \begin{center}\small\setlength{\baselineskip}{1.2zw}
    \begin{tabular}{#1}}{%
    \end{tabular}
  \end{center}}

\newenvironment{reviewcolumn}{%
     \begin{framed}
  }{%
     \end{framed}
  \vspace{2zw}}

\newcommand{\reviewcolumnhead}[2]{%
{\noindent\large <%= escape_latex(I18n.t('column_head'))%>: #2}}

\newcommand{\reviewtablecaption}[1]{%
  \caption{#1}}

\WithSuffix\newcommand\reviewtablecaption*[1]{%
  \caption*{#1}}

\newcommand{\reviewimgtablecaption}[1]{%
  \caption{#1}\vspace{-3mm}}

\newcommand{\reviewbackslash}[0]{%
  \textbackslash{}}

\newcommand{\reviewlistcaption}[1]{%
  \medskip{\small\noindent #1}\vspace*{-1.3zw}}

\newcommand{\reviewemlistcaption}[1]{%
  \medskip{\small\noindent #1}\vspace*{-1.3zw}}

\newcommand{\reviewsourcecaption}[1]{%
  \medskip{\small\noindent #1}\vspace*{-1.3zw}}

\newcommand{\reviewcmdcaption}[1]{%
  \medskip{\small\noindent #1}\vspace*{-1.3zw}}

\newcommand{\reviewindepimagecaption}[1]{%
  \begin{center}#1\end{center}}

\newcommand{\reviewboxcaption}[1]{%
  \medskip{\small\noindent #1}\vspace*{-1.3zw}}

\newcommand{\reviewimageref}[2]{<%= escape_latex(I18n.t('image'))%> #1}
\newcommand{\reviewtableref}[2]{<%= escape_latex(I18n.t('table'))%> #1}
\newcommand{\reviewlistref}[1]{<%= escape_latex(I18n.t('list'))%> #1}
\newcommand{\reviewbibref}[2]{#1}
\newcommand{\reviewcolumnref}[2]{<%= escape_latex(I18n.t('columnname'))%> #1}
\newcommand{\reviewsecref}[2]{#1}

\newcommand{\reviewminicolumntitle}[1]{%
  {\large <%= escape_latex(I18n.t('memo_head'))%>: #1}\\}

<%- if @config['toctitle'].present? -%>
\renewcommand{\contentsname}{<%= escape_latex(@config['toctitle']) %>}
<%- elsif I18n.t('toctitle') -%>
\renewcommand{\contentsname}{<%= escape_latex(I18n.t('toctitle')) %>}
<%- end -%>

\newenvironment{reviewminicolumn}{%
  \vspace{1.5zw}\begin{screen}}{%
  \end{screen}\vspace{2zw}}

\newcommand{\reviewcolophon}[0]{\clearpage}
\newcommand{\reviewappendix}[0]{\appendix}

\newcommand{\reviewprepartname}{<%= escape_latex(@locale_latex['prepartname']) %>}
\newcommand{\reviewpostpartname}{<%= escape_latex(@locale_latex['postpartname']) %>}
\newcommand{\reviewprechaptername}{<%= escape_latex(@locale_latex['prechaptername']) %>}
\newcommand{\reviewpostchaptername}{<%= escape_latex(@locale_latex['postchaptername']) %>}
\newcommand{\reviewfigurename}{<%= escape_latex(I18n.t('image')) %>}
\newcommand{\reviewtablename}{<%= escape_latex(I18n.t('table')) %>}
\newcommand{\reviewappendixname}{<%= escape_latex(@locale_latex['preappendixname']) %>}

\ifdefined\prepartname
  \renewcommand{\prepartname}{\reviewprepartname}
\fi
\ifdefined\postpartname
  \renewcommand{\postpartname}{\reviewpostpartname}
\fi
\ifdefined\prechaptername
  \renewcommand{\prechaptername}{\reviewprechaptername}
\fi
\ifdefined\postchaptername
  \renewcommand{\postchaptername}{\reviewpostchaptername}
\fi
\ifdefined\figurename
  \renewcommand{\figurename}{\reviewfigurename}
\fi
\ifdefined\tablename
  \renewcommand{\tablename}{\reviewtablename}
\fi
\ifdefined\appendixname
  \renewcommand{\appendixname}{\reviewappendixname}
\fi

\makeatletter
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\def\maxwidth{%
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother
